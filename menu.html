<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SmartCafe Premium Menu</title>

<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&display=swap" rel="stylesheet">

<!-- Prism.js CSS -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" />

<style>
:root[data-theme="dark"]{
  --primary:#ff4757;
  --primary-dark:#e63946;
  --bg:#0a0e1a;
  --bg-gradient-start:#0a0e1a;
  --bg-gradient-end:#1a1f35;
  --card:#1a1f35;
  --card-hover:#252b45;
  --text:#f1f5f9;
  --muted:#94a3b8;
  --accent:#06b6d4;
  --search-bg:rgba(26,31,53,0.8);
  --search-border:rgba(255,255,255,0.1);
}

:root[data-theme="light"]{
  --primary:#ff4757;
  --primary-dark:#e63946;
  --bg:#f8fafc;
  --bg-gradient-start:#f8fafc;
  --bg-gradient-end:#e2e8f0;
  --card:#ffffff;
  --card-hover:#f1f5f9;
  --text:#0f172a;
  --muted:#64748b;
  --accent:#0891b2;
  --search-bg:rgba(255,255,255,0.9);
  --search-border:rgba(0,0,0,0.1);
}

*{box-sizing:border-box;margin:0;padding:0}

body{
  font-family:'Outfit',sans-serif;
  background:linear-gradient(135deg,var(--bg-gradient-start) 0%,var(--bg-gradient-end) 100%);
  color:var(--text);
  min-height:100vh;
  position:relative;
  overflow-x:hidden;
  transition:background 0.3s ease, color 0.3s ease;
}

body::before{
  content:'';
  position:fixed;
  width:400px;
  height:400px;
  background:radial-gradient(circle,rgba(255,71,87,0.15),transparent);
  top:-200px;
  right:-200px;
  pointer-events:none;
  animation:float 8s ease-in-out infinite;
}

body::after{
  content:'';
  position:fixed;
  width:300px;
  height:300px;
  background:radial-gradient(circle,rgba(6,182,212,0.12),transparent);
  bottom:-150px;
  left:-150px;
  pointer-events:none;
  animation:float 10s ease-in-out infinite reverse;
}

@keyframes float{
  0%,100%{transform:translate(0,0) rotate(0deg)}
  33%{transform:translate(30px,-30px) rotate(5deg)}
  66%{transform:translate(-20px,20px) rotate(-5deg)}
}

.loading-overlay{
  position:fixed;
  inset:0;
  background:var(--bg);
  z-index:9999;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  gap:20px;
  transition:opacity 0.5s ease;
}

.loading-overlay.hidden{
  opacity:0;
  pointer-events:none;
}

.spinner{
  width:60px;
  height:60px;
  border:4px solid rgba(255,71,87,0.2);
  border-top-color:var(--primary);
  border-radius:50%;
  animation:spin 0.5s linear infinite;
}

@keyframes spin{
  to{transform:rotate(360deg)}
}

.loading-text{
  font-size:1.2rem;
  font-weight:600;
  background:linear-gradient(135deg,var(--primary),var(--accent));
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
  background-clip:text;
  animation:pulse 1.5s ease-in-out infinite;
}

@keyframes pulse{
  0%,100%{opacity:1}
  50%{opacity:0.5}
}

header{
  background:var(--search-bg);
  backdrop-filter:blur(20px);
  padding:16px 5%;
  display:flex;
  justify-content:space-between;
  align-items:center;
  position:sticky;
  top:0;
  z-index:100;
  border-bottom:1px solid var(--search-border);
  box-shadow:0 4px 30px rgba(0,0,0,0.1);
  transition:all 0.3s ease;
}

.logo{
  font-size:1.8rem;
  font-weight:700;
  background:linear-gradient(135deg,var(--primary),var(--accent));
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
  background-clip:text;
  letter-spacing:-1px;
}

.header-actions{
  display:flex;
  gap:12px;
  align-items:center;
}

.theme-toggle{
  width:45px;
  height:45px;
  border-radius:50%;
  background:rgba(255,255,255,0.05);
  border:1px solid var(--search-border);
  cursor:pointer;
  display:flex;
  align-items:center;
  justify-content:center;
  transition:all 0.3s ease;
  font-size:1.3rem;
}

.theme-toggle:hover{
  background:rgba(255,255,255,0.1);
  transform:rotate(180deg);
}

.logout-btn{
  border-radius:25px;
  padding:10px 20px;
  cursor:pointer;
  font-weight:600;
  font-size:0.9rem;
  transition:all 0.3s ease;
  border:none;
  background:linear-gradient(135deg,var(--primary),var(--primary-dark));
  color:white;
  box-shadow:0 4px 15px rgba(255,71,87,0.3);
  display:flex;
  align-items:center;
  gap:8px;
}

.logout-btn:hover{
  transform:translateY(-2px);
  box-shadow:0 6px 20px rgba(255,71,87,0.4);
}

.search-container{
  max-width:1400px;
  margin:0 auto;
  padding:30px 20px 20px;
  position:relative;
  z-index:1;
}

.search-wrapper{
  position:relative;
  max-width:600px;
  margin:0 auto;
}

.search-input{
  width:100%;
  padding:16px 50px 16px 50px;
  background:var(--search-bg);
  backdrop-filter:blur(20px);
  border:2px solid var(--search-border);
  border-radius:50px;
  color:var(--text);
  font-family:'Outfit',sans-serif;
  font-size:1rem;
  transition:all 0.3s ease;
}

.search-input:focus{
  outline:none;
  border-color:var(--primary);
  box-shadow:0 0 0 4px rgba(255,71,87,0.1);
}

.search-input::placeholder{color:var(--muted)}

.search-icon{
  position:absolute;
  left:20px;
  top:50%;
  transform:translateY(-50%);
  color:var(--muted);
  pointer-events:none;
}

.search-icon svg{
  width:20px;
  height:20px;
  fill:var(--muted);
}

.clear-search{
  position:absolute;
  right:20px;
  top:50%;
  transform:translateY(-50%);
  color:var(--muted);
  cursor:pointer;
  font-size:1.2rem;
  display:none;
  transition:all 0.3s ease;
}

.clear-search:hover{color:var(--primary)}

.search-results-info{
  text-align:center;
  margin-top:15px;
  color:var(--muted);
  font-size:0.9rem;
}

.container{
  max-width:1400px;
  margin:0 auto;
  padding:20px 20px 80px;
  position:relative;
  z-index:1;
}

.hero-section{
  text-align:center;
  margin-bottom:50px;
  padding:30px 20px;
}

.hero-section h1{
  font-size:3rem;
  font-weight:700;
  margin-bottom:15px;
  background:linear-gradient(135deg,var(--text),var(--accent));
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
  background-clip:text;
}

.hero-section p{
  color:var(--muted);
  font-size:1.1rem;
  max-width:600px;
  margin:0 auto;
}

.cat-title{
  font-size:1.8rem;
  font-weight:700;
  margin:50px 0 25px;
  color:var(--text);
  display:flex;
  align-items:center;
  gap:15px;
}

.cat-title::before{
  content:'';
  width:4px;
  height:35px;
  background:linear-gradient(180deg,var(--primary),var(--accent));
  border-radius:10px;
}

.grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(280px,1fr));
  gap:25px;
}

.card{
  background:var(--card);
  border-radius:24px;
  overflow:hidden;
  position:relative;
  transition:all 0.4s cubic-bezier(0.175,0.885,0.32,1.275);
  border:1px solid var(--search-border);
  cursor:pointer;
}

.card:hover{
  transform:translateY(-8px);
  background:var(--card-hover);
  box-shadow:0 20px 40px rgba(0,0,0,0.2);
  border-color:rgba(255,71,87,0.3);
}

.card.hidden{display:none}

.img-box{
  height:200px;
  position:relative;
  overflow:hidden;
}

.img-box::after{
  content:'';
  position:absolute;
  inset:0;
  background:linear-gradient(180deg,transparent 0%,rgba(0,0,0,0.7) 100%);
  opacity:0;
  transition:opacity 0.3s;
}

.card:hover .img-box::after{opacity:1}

.img-box img{
  width:100%;
  height:100%;
  object-fit:cover;
  transition:transform 0.5s ease;
}

.card:hover .img-box img{transform:scale(1.1)}

.price{
  position:absolute;
  top:15px;
  right:15px;
  background:rgba(0,0,0,0.85);
  backdrop-filter:blur(10px);
  padding:8px 16px;
  border-radius:20px;
  font-size:1rem;
  font-weight:700;
  color:var(--primary);
  z-index:2;
  border:1px solid rgba(255,71,87,0.3);
}

.status-badge{
  position:absolute;
  top:15px;
  left:15px;
  padding:6px 14px;
  border-radius:20px;
  font-size:0.75rem;
  font-weight:700;
  text-transform:uppercase;
  letter-spacing:0.5px;
  z-index:2;
  backdrop-filter:blur(10px);
}

.st-available{background:rgba(34,197,94,0.9);color:#000}
.st-few{background:rgba(251,191,36,0.9);color:#000}
.st-sold{background:rgba(239,68,68,0.9);color:#fff}

.details{padding:20px}

.details h3{
  font-size:1.2rem;
  margin-bottom:8px;
  color:var(--text);
  font-weight:600;
}

.details p{
  color:var(--muted);
  font-size:0.9rem;
  line-height:1.5;
}

.no-results{
  text-align:center;
  padding:60px 20px;
  color:var(--muted);
}

.no-results h3{
  font-size:1.5rem;
  margin-bottom:10px;
  color:var(--text);
}

/* CHATBOT */
.chatbot-button{
  position:fixed;
  bottom:30px;
  right:30px;
  width:60px;
  height:60px;
  border-radius:50%;
  background:linear-gradient(135deg,#ff4757,#e63946);
  border:none;
  cursor:pointer;
  box-shadow:0 8px 25px rgba(255,71,87,0.6);
  z-index:200;
  display:flex;
  align-items:center;
  justify-content:center;
  transition:all 0.3s ease;
}

.chatbot-button:hover{
  transform:scale(1.1);
  box-shadow:0 10px 30px rgba(255,71,87,0.8);
}

.chatbot-button svg{
  width:30px;
  height:30px;
  fill:white;
}

.chatbot-container{
  position:fixed;
  bottom:100px;
  right:30px;
  width:450px;
  height:600px;
  background:#1a1a1a;
  border-radius:24px;
  box-shadow:0 20px 60px rgba(0,0,0,0.8);
  display:none;
  flex-direction:column;
  z-index:200;
  border:2px solid #ff4757;
  overflow:hidden;
}

.chatbot-container.active{display:flex}

.chatbot-header{
  background:linear-gradient(135deg,#ff4757,#e63946);
  padding:20px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.chatbot-header h3{
  font-size:1.2rem;
  color:white;
  margin:0;
}

.chatbot-close{
  background:rgba(0,0,0,0.3);
  border:none;
  color:white;
  width:30px;
  height:30px;
  border-radius:50%;
  cursor:pointer;
  font-size:1.2rem;
  display:flex;
  align-items:center;
  justify-content:center;
  transition:all 0.3s ease;
}

.chatbot-close:hover{
  background:rgba(0,0,0,0.5);
  transform:rotate(90deg);
}

.chatbot-messages{
  flex:1;
  overflow-y:auto;
  padding:20px;
  display:flex;
  flex-direction:column;
  gap:15px;
  background:#0a0a0a;
}

.message{
  display:flex;
  gap:10px;
  animation:slideIn 0.3s ease;
}

@keyframes slideIn{
  from{opacity:0;transform:translateY(10px)}
  to{opacity:1;transform:translateY(0)}
}

.message.user{flex-direction:row-reverse}

.message-avatar{
  width:35px;
  height:35px;
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  flex-shrink:0;
  font-size:1.2rem;
}

.message.bot .message-avatar{
  background:linear-gradient(135deg,#ff4757,#e63946);
  box-shadow:0 2px 8px rgba(255,71,87,0.4);
}

.message.user .message-avatar{
  background:#2a2a2a;
  border:2px solid #ff4757;
}

.message-content{
  background:#1a1a1a;
  padding:12px 16px;
  border-radius:16px;
  max-width:80%;
  line-height:1.6;
  font-size:0.95rem;
  border:1px solid #2a2a2a;
  color:#f1f5f9;
}

.message.user .message-content{
  background:linear-gradient(135deg,#ff4757,#e63946);
  color:white;
  border:none;
  box-shadow:0 2px 8px rgba(255,71,87,0.3);
}

/* CODE BLOCK WRAPPER */
.code-block-wrapper{
  position:relative;
  margin:10px 0;
  border-radius:8px;
  overflow:hidden;
  background:#1d1f21;
  border:1px solid #2a2a2a;
}

.code-block-header{
  background:#2a2a2a;
  padding:8px 12px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  border-bottom:1px solid #3a3a3a;
}

.code-language-label{
  font-size:0.75rem;
  color:#6a6a6a;
  text-transform:uppercase;
  letter-spacing:0.5px;
  font-weight:600;
}

.copy-code-btn{
  background:transparent;
  color:#6a6a6a;
  border:none;
  padding:6px;
  border-radius:4px;
  cursor:pointer;
  display:flex;
  align-items:center;
  gap:6px;
  transition:all 0.3s ease;
}

.copy-code-btn:hover{
  background:rgba(255,71,87,0.1);
  color:#ff4757;
}

.copy-code-btn svg{
  width:16px;
  height:16px;
  fill:currentColor;
}

.copy-code-btn.copied{
  color:#22c55e;
}

.code-block-wrapper pre[class*="language-"]{
  margin:0 !important;
  padding:1em !important;
  background:#1d1f21 !important;
  border-radius:0 !important;
}

.code-block-wrapper code[class*="language-"]{
  background:transparent !important;
  font-family:'Consolas','Monaco','Courier New',monospace !important;
  font-size:0.85rem !important;
  line-height:1.5 !important;
}

/* CHAT TABLE */
.chat-table{
  width:100%;
  border-collapse:collapse;
  margin:10px 0;
  font-size:0.85rem;
  background:#0a0a0a;
  border-radius:8px;
  overflow:hidden;
  border:1px solid #2a2a2a;
}

.chat-table thead{background:#ff4757}

.chat-table th{
  padding:8px 10px;
  text-align:left;
  font-weight:600;
  border-bottom:2px solid #e63946;
  color:white;
}

.chat-table td{
  padding:8px 10px;
  border-bottom:1px solid #2a2a2a;
  color:#f1f5f9;
}

.chat-table tr:last-child td{border-bottom:none}
.chat-table tbody tr:hover{background:#1a1a1a}

.status-available{color:#22c55e;font-weight:600}
.status-few{color:#fbbf24;font-weight:600}
.status-sold{color:#ef4444;font-weight:600}

.chatbot-input-area{
  padding:20px;
  border-top:2px solid #ff4757;
  display:flex;
  gap:10px;
  background:#1a1a1a;
}

.chatbot-input{
  flex:1;
  background:#0a0a0a;
  border:1px solid #2a2a2a;
  border-radius:20px;
  padding:12px 16px;
  color:#f1f5f9;
  font-family:'Outfit',sans-serif;
  font-size:0.95rem;
  transition:all 0.3s ease;
}

.chatbot-input:focus{
  outline:none;
  border-color:#ff4757;
  box-shadow:0 0 0 2px rgba(255,71,87,0.2);
}

.chatbot-input::placeholder{color:#6a6a6a}

.chatbot-send{
  background:linear-gradient(135deg,#ff4757,#e63946);
  border:none;
  width:45px;
  height:45px;
  border-radius:50%;
  cursor:pointer;
  display:flex;
  align-items:center;
  justify-content:center;
  transition:all 0.3s ease;
  box-shadow:0 2px 8px rgba(255,71,87,0.4);
}

.chatbot-send:hover{
  transform:scale(1.1);
  box-shadow:0 4px 12px rgba(255,71,87,0.6);
}

.chatbot-send svg{
  width:20px;
  height:20px;
  fill:white;
}

.typing-indicator{
  display:flex;
  gap:5px;
  padding:12px 16px;
}

.typing-indicator span{
  width:8px;
  height:8px;
  border-radius:50%;
  background:#ff4757;
  animation:typing 1.4s infinite;
}

.typing-indicator span:nth-child(2){animation-delay:0.2s}
.typing-indicator span:nth-child(3){animation-delay:0.4s}

@keyframes typing{
  0%,60%,100%{opacity:0.3}
  30%{opacity:1}
}

.loading{
  text-align:center;
  color:var(--muted);
  font-size:1.1rem;
  padding:60px 20px;
}

@media(max-width:768px){
  .hero-section h1{font-size:2rem}
  .grid{grid-template-columns:repeat(2,1fr);gap:15px}
  .cat-title{font-size:1.5rem}
  .card{border-radius:18px}
  .img-box{height:160px}
  .details{padding:15px}
  .details h3{font-size:1rem}
  .details p{font-size:0.85rem}
  .price{font-size:0.85rem;padding:6px 12px}
  .status-badge{font-size:0.65rem;padding:5px 10px}
  .chatbot-container{width:calc(100% - 20px);right:10px;left:10px;bottom:90px;height:500px}
  .chatbot-button{right:20px;bottom:20px}
  .search-wrapper{max-width:100%}
}

@media(max-width:480px){
  .logo{font-size:1.4rem}
  .logout-btn{padding:8px 14px;font-size:0.85rem}
  .hero-section h1{font-size:1.6rem}
  .hero-section p{font-size:0.95rem}
  .cat-title{font-size:1.3rem}
  .grid{gap:12px}
  .theme-toggle{width:40px;height:40px;font-size:1.1rem}
}

@media(min-width:769px) and (max-width:1024px){
  .grid{grid-template-columns:repeat(3,1fr)}
}

@media(min-width:1025px){
  .grid{grid-template-columns:repeat(4,1fr)}
}
</style>
</head>

<body>

<div class="loading-overlay" id="loadingOverlay">
  <div class="spinner"></div>
  <div class="loading-text">Loading SmartCafe...</div>
</div>

<header>
  <div class="logo">SmartCafe.</div>
  <div class="header-actions">
    <button class="theme-toggle" onclick="toggleTheme()" title="Toggle Theme">
      <span id="themeIcon">üåô</span>
    </button>
    <button class="logout-btn" onclick="handleLogout()">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4M16 17l5-5-5-5M21 12H9"/>
      </svg>
      Logout
    </button>
  </div>
</header>

<div class="search-container">
  <div class="search-wrapper">
    <div class="search-icon">
      <svg viewBox="0 0 24 24">
        <path fill="currentColor" d="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z"/>
      </svg>
    </div>
    <input type="text" class="search-input" id="searchInput" placeholder="Search menu items, categories..." onkeyup="searchMenu()">
    <span class="clear-search" id="clearSearch" onclick="clearSearch()">‚úï</span>
  </div>
  <div class="search-results-info" id="searchResultsInfo"></div>
</div>

<div class="container">
  <div class="hero-section">
    <h1>SmartCafe Delicious Menu</h1>
    <p>Explore our handcrafted selection of premium dishes made with love</p>
  </div>
  <div id="root">
    <div class="loading">Loading Menu...</div>
  </div>
</div>

<button class="chatbot-button" onclick="toggleChatbot()">
  <svg viewBox="0 0 24 24">
    <path d="M12 2C6.48 2 2 6.48 2 12c0 1.54.36 3 .97 4.29L2 22l5.71-.97C9 21.64 10.46 22 12 22c5.52 0 10-4.48 10-10S17.52 2 12 2zm0 18c-1.38 0-2.68-.29-3.86-.81l-.28-.13-2.76.47.47-2.76-.13-.28C4.29 14.68 4 13.38 4 12c0-4.41 3.59-8 8-8s8 3.59 8 8-3.59 8-8 8z"/>
  </svg>
</button>

<div class="chatbot-container" id="chatbotContainer">
  <div class="chatbot-header">
    <h3>SmartCafe Assistant üçΩÔ∏è</h3>
    <button class="chatbot-close" onclick="toggleChatbot()">√ó</button>
  </div>
  <div class="chatbot-messages" id="chatMessages">
    <div class="message bot">
      <div class="message-avatar">ü§ñ</div>
      <div class="message-content">
        Hi! I'm your SmartCafe assistant. Ask me about our menu items, prices, availability, or ask coding questions with syntax highlighting!
      </div>
    </div>
  </div>
  <div class="chatbot-input-area">
    <input type="text" class="chatbot-input" id="chatInput" placeholder="Ask about menu or code..." onkeypress="handleChatKeypress(event)">
    <button class="chatbot-send" onclick="sendMessage()">
      <svg viewBox="0 0 24 24">
        <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>
      </svg>
    </button>
  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-javascript.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-java.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-css.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-markup.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-php.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-sql.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-json.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-bash.min.js"></script>

<script>
const API_URL="https://script.google.com/macros/s/AKfycbzJCwL-TlsX70KAnSLvj0q1gasdDYLqXqDY_lQ8Wg7RE3uWFrLq-hRdPfIe5coqKL-b/exec";
const CEREBRAS_API_KEY="csk-mrnne8wxj3hmxf5yfctd3j3rc3km385vxkt3jrehp6ctdkw8";
const CEREBRAS_API_URL="https://api.cerebras.ai/v1/chat/completions";

let menuData=[];
let currentTheme='dark';

function initTheme(){
  const savedTheme=localStorage.getItem('smartcafe-theme')||'dark';
  currentTheme=savedTheme;
  document.documentElement.setAttribute('data-theme',savedTheme);
  updateThemeIcon();
}

function toggleTheme(){
  currentTheme=currentTheme==='dark'?'light':'dark';
  document.documentElement.setAttribute('data-theme',currentTheme);
  localStorage.setItem('smartcafe-theme',currentTheme);
  updateThemeIcon();
}

function updateThemeIcon(){
  document.getElementById('themeIcon').textContent=currentTheme==='dark'?'üåô':'‚òÄÔ∏è';
}

function handleLogout(){
  if(confirm('Are you sure you want to logout?')){
    window.location.href='login.html';
  }
}

function searchMenu(){
  const searchTerm=document.getElementById('searchInput').value.toLowerCase().trim();
  const cards=document.querySelectorAll('.card');
  const categories=document.querySelectorAll('.cat-title');
  const clearBtn=document.getElementById('clearSearch');
  let visibleCount=0;
  
  clearBtn.style.display=searchTerm?'block':'none';
  
  categories.forEach(catTitle=>{
    const category=catTitle.textContent.toLowerCase();
    const categoryCards=Array.from(cards).filter(card=>{
      const cardCategory=card.closest('.grid')?.previousElementSibling?.textContent.toLowerCase();
      return cardCategory===category;
    });
    
    let categoryHasVisible=false;
    
    categoryCards.forEach(card=>{
      const name=card.querySelector('.details h3')?.textContent.toLowerCase()||'';
      const desc=card.querySelector('.details p')?.textContent.toLowerCase()||'';
      const cardCategory=card.closest('.grid')?.previousElementSibling?.textContent.toLowerCase()||'';
      
      if(searchTerm===''||name.includes(searchTerm)||desc.includes(searchTerm)||cardCategory.includes(searchTerm)){
        card.classList.remove('hidden');
        visibleCount++;
        categoryHasVisible=true;
      }else{
        card.classList.add('hidden');
      }
    });
    
    if(searchTerm===''||categoryHasVisible){
      catTitle.style.display='flex';
      catTitle.nextElementSibling.style.display='grid';
    }else{
      catTitle.style.display='none';
      catTitle.nextElementSibling.style.display='none';
    }
  });
  
  const resultsInfo=document.getElementById('searchResultsInfo');
  if(searchTerm){
    resultsInfo.textContent=`Found ${visibleCount} item${visibleCount!==1?'s':''}`;
  }else{
    resultsInfo.textContent='';
  }
  
  if(visibleCount===0&&searchTerm){
    showNoResults();
  }else{
    hideNoResults();
  }
}

function clearSearch(){
  document.getElementById('searchInput').value='';
  searchMenu();
}

function showNoResults(){
  const root=document.getElementById('root');
  if(!document.getElementById('noResultsMsg')){
    const noResults=document.createElement('div');
    noResults.id='noResultsMsg';
    noResults.className='no-results';
    noResults.innerHTML='<h3>No items found</h3><p>Try searching with different keywords</p>';
    root.appendChild(noResults);
  }
}

function hideNoResults(){
  const noResults=document.getElementById('noResultsMsg');
  if(noResults)noResults.remove();
}

function showLoading(){
  document.getElementById('loadingOverlay').classList.remove('hidden');
}

function hideLoading(){
  setTimeout(()=>{
    document.getElementById('loadingOverlay').classList.add('hidden');
  },800);
}

async function fetchMenu(){
  try{
    const res=await fetch(API_URL+'?action=getMenu&timestamp='+new Date().getTime());
    menuData=await res.json();
    console.log('Menu data loaded:',menuData);
    render();
    hideLoading();
  }catch(e){
    console.error('Error fetching menu:',e);
    document.getElementById('root').innerHTML='<div class="loading">Error loading menu. Please refresh.</div>';
    hideLoading();
  }
}

function render(){
  const root=document.getElementById('root');
  root.innerHTML="";
  
  const categories=[...new Set(menuData.map(i=>i.category))];
  
  if(categories.length===0){
    root.innerHTML='<div class="loading">No items in menu yet.</div>';
    return;
  }
  
  categories.forEach(cat=>{
    const items=menuData.filter(i=>i.category===cat);
    let html=`<div class="cat-title">${cat}</div><div class="grid">`;
    
    items.forEach(item=>{
      let badgeClass="st-available",badgeText="Available";
      const itemStatus=String(item.status).toLowerCase().trim();
      
      if(itemStatus==="few"){
        badgeClass="st-few";
        badgeText="Few Left";
      }else if(itemStatus==="sold"){
        badgeClass="st-sold";
        badgeText="Sold Out";
      }
      
      const itemId=String(item.id);
      
      html+=`
      <div class="card" data-id="${itemId}">
        <div class="img-box">
          <span class="price">‚Çπ${item.price}</span>
          <span class="status-badge ${badgeClass}">${badgeText}</span>
          <img src="${item.image||'https://via.placeholder.com/300'}" alt="${item.name}" onerror="this.src='https://via.placeholder.com/300'">
        </div>
        <div class="details">
          <h3>${item.name}</h3>
          <p>${item.description||'Delicious item from our menu'}</p>
        </div>
      </div>`;
    });
    
    root.innerHTML+=html+"</div>";
  });
  
  searchMenu();
}

function toggleChatbot(){
  const container=document.getElementById('chatbotContainer');
  container.classList.toggle('active');
}

function handleChatKeypress(event){
  if(event.key==='Enter')sendMessage();
}

async function sendMessage(){
  const input=document.getElementById('chatInput');
  const message=input.value.trim();
  
  if(!message)return;
  
  addMessageToChat('user',message);
  input.value='';
  
  showTypingIndicator();
  
  try{
    const response=await getCerebrasResponse(message);
    removeTypingIndicator();
    addMessageToChat('bot',response,true);
  }catch(e){
    removeTypingIndicator();
    addMessageToChat('bot','Sorry, I encountered an error. Please try again.');
    console.error('Chatbot error:',e);
  }
}

function addMessageToChat(sender,text,isHTML=false){
  const messagesDiv=document.getElementById('chatMessages');
  const messageDiv=document.createElement('div');
  messageDiv.className=`message ${sender}`;
  
  const avatar=document.createElement('div');
  avatar.className='message-avatar';
  avatar.textContent=sender==='bot'?'ü§ñ':'üë§';
  
  const content=document.createElement('div');
  content.className='message-content';
  
  if(isHTML){
    content.innerHTML=text;
  }else{
    content.textContent=text;
  }
  
  messageDiv.appendChild(avatar);
  messageDiv.appendChild(content);
  messagesDiv.appendChild(messageDiv);
  
  messagesDiv.scrollTop=messagesDiv.scrollHeight;
}

function showTypingIndicator(){
  const messagesDiv=document.getElementById('chatMessages');
  const typingDiv=document.createElement('div');
  typingDiv.className='message bot';
  typingDiv.id='typingIndicator';
  
  const avatar=document.createElement('div');
  avatar.className='message-avatar';
  avatar.textContent='ü§ñ';
  
  const indicator=document.createElement('div');
  indicator.className='typing-indicator';
  indicator.innerHTML='<span></span><span></span><span></span>';
  
  typingDiv.appendChild(avatar);
  typingDiv.appendChild(indicator);
  messagesDiv.appendChild(typingDiv);
  messagesDiv.scrollTop=messagesDiv.scrollHeight;
}

function removeTypingIndicator(){
  const indicator=document.getElementById('typingIndicator');
  if(indicator)indicator.remove();
}

async function getCerebrasResponse(userMessage){
  const menuContext=createMenuContext();
  
  const systemPrompt=`You are a helpful restaurant menu assistant for SmartCafe.

**For CODING Questions:**
1. ALWAYS wrap code in markdown code blocks: \`\`\`language\\ncode\\n\`\`\`
2. Supported languages: python, javascript, java, html, css, php, sql, json, bash
3. Keep code properly formatted

**For MENU Questions:**
1. Show multiple items in HTML tables:
   <table class="chat-table">
     <thead><tr><th>Item</th><th>Price</th><th>Status</th></tr></thead>
     <tbody>
       <tr><td>Name</td><td>‚ÇπPrice</td><td class="status-available">Available</td></tr>
     </tbody>
   </table>

MENU DATA:
${menuContext}`;

  try{
    const response=await fetch(CEREBRAS_API_URL,{
      method:'POST',
      headers:{
        'Content-Type':'application/json',
        'Authorization':`Bearer ${CEREBRAS_API_KEY}`
      },
      body:JSON.stringify({
        model:'llama-3.3-70b',
        messages:[
          {role:'system',content:systemPrompt},
          {role:'user',content:userMessage}
        ],
        max_tokens:1500,
        temperature:0.7
      })
    });
    
    const data=await response.json();
    let content=data.choices[0].message.content;
    
    content=convertMarkdownCodeToHTML(content);
    
    return content;
  }catch(error){
    console.error('Cerebras API error:',error);
    throw error;
  }
}

function convertMarkdownCodeToHTML(text){
  const codeBlockRegex=/```(\w+)?\s*\n([\s\S]*?)```/g;
  
  return text.replace(codeBlockRegex,(match,language,code)=>{
    const lang=language||'plaintext';
    const escapedCode=escapeHtml(code.trim());
    const codeId='code_'+Math.random().toString(36).substr(2,9);
    
    setTimeout(()=>{
      const codeElement=document.getElementById(codeId);
      if(codeElement){
        Prism.highlightElement(codeElement);
      }
    },100);
    
    return `
<div class="code-block-wrapper">
  <div class="code-block-header">
    <span class="code-language-label">${lang}</span>
    <button class="copy-code-btn" onclick="copyCodeToClipboard('${codeId}', event)">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
        <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
      </svg>
    </button>
  </div>
  <pre><code id="${codeId}" class="language-${lang}">${escapedCode}</code></pre>
</div>`;
  });
}

function copyCodeToClipboard(codeId, event){
  const codeElement=document.getElementById(codeId);
  if(!codeElement)return;
  
  const code=codeElement.textContent;
  
  navigator.clipboard.writeText(code).then(()=>{
    const btn=event.currentTarget;
    const originalHTML=btn.innerHTML;
    
    btn.innerHTML=`
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <polyline points="20 6 9 17 4 12"></polyline>
      </svg>`;
    btn.classList.add('copied');
    
    setTimeout(()=>{
      btn.innerHTML=originalHTML;
      btn.classList.remove('copied');
    },2000);
  }).catch(err=>{
    console.error('Failed to copy:',err);
  });
}

function escapeHtml(text){
  const div=document.createElement('div');
  div.textContent=text;
  return div.innerHTML;
}

function createMenuContext(){
  let context='CATEGORIES AND ITEMS:\n\n';
  
  const categories=[...new Set(menuData.map(i=>i.category))];
  
  categories.forEach(cat=>{
    context+=`${cat}:\n`;
    const items=menuData.filter(i=>i.category===cat);
    items.forEach(item=>{
      const statusText=item.status==='available'?'Available':item.status==='few'?'Few Left':'Sold Out';
      context+=`- ${item.name}: ‚Çπ${item.price} (${statusText})${item.description?' - '+item.description:''}\n`;
    });
    context+='\n';
  });
  
  return context;
}

initTheme();
showLoading();
fetchMenu();
</script>

</body>
</html>

